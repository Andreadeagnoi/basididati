CREATE TABLE PERSONAGGIO(
ID_Personaggio INTEGER NOT NULL,
Nome VARCHAR(30) NOT NULL,
Sprite VARCHAR NOT NULL,
P_HP INTEGER NOT NULL,
P_MP INTEGER NOT NULL,
P_ATK INTEGER NOT NULL,
P_DEF INTEGER NOT NULL,
P_INT INTEGER NOT NULL,
P_AGI INTEGER NOT NULL,
PRIMARY KEY(ID_Personaggio),
CHECK(
ID_Personaggio >= 0
AND P_HP >= 0
AND P_MP >= 0
AND p_ATK >= 0
AND P_DEF >= 0
AND P_INT >= 0
AND P_AGI >= 0
)
);

CREATE TABLE SALVATAGGIO_GIOCATORE(
DataCreazione TIMESTAMP NOT NULL,
Nome VARCHAR(20) NOT NULL,
TempoGiocato TIMESTAMP,
DataUltimoSalvataggio TIMESTAMP,
PRIMARY KEY(DataCreazione)
);

CREATE TABLE ISTANZA_PERSONAGGIO(
ID_Personaggio INTEGER NOT NULL,
DataCreazione TIMESTAMP NOT NULL,
Nome VARCHAR(30) NOT NULL,
Sprite VARCHAR NOT NULL,
IP_HP INTEGER NOT NULL,
IP_MP INTEGER NOT NULL,
IP_ATK INTEGER NOT NULL,
IP_DEF INTEGER NOT NULL,
IP_INT INTEGER NOT NULL,
IP_AGI INTEGER NOT NULL,
PRIMARY KEY(ID_Personaggio, DataCreazione),
CHECK(
ID_Personaggio >= 0
AND IP_HP >= 0
AND IP_MP >= 0
AND IP_ATK >= 0
AND IP_DEF >= 0
AND IP_INT >= 0
AND IP_AGI >= 0
),
FOREIGN KEY(ID_Personaggio) REFERENCES PERSONAGGIO(ID_Personaggio)
			ON UPDATE CASCADE ON DELETE RESTRICT,
FOREIGN KEY(DataCreazione) REFERENCES SALVATAGGIO_GIOCATORE(DataCreazione)
			ON UPDATE CASCADE ON DELETE RESTRICT
);

CREATE TABLE CLASSE(
ID_Classe INTEGER NOT NULL,
Nome VARCHAR(20) NOT NULL,
LivelloMax INTEGER NOT NULL,
C_HP INTEGER NOT NULL,
C_MP INTEGER NOT NULL,
C_ATK INTEGER NOT NULL,
C_DEF INTEGER NOT NULL,
C_INT INTEGER NOT NULL,
C_AGI INTEGER NOT NULL,
PRIMARY KEY(ID_Classe),
CHECK(
ID_Classe >= 0
AND C_HP >= 0
AND C_MP >= 0
AND C_ATK >= 0
AND C_DEF >= 0
AND C_INT >= 0
AND C_AGI >= 0
)
);

CREATE TABLE Appartiene(
ID_Personaggio INTEGER NOT NULL,
DataCreazione TIMESTAMP NOT NULL,
ID_Classe INTEGER NOT NULL,
InUso BOOLEAN,
LivelloClasse INTEGER,
EXP INTEGER,
PRIMARY KEY (ID_Personaggio, DataCreazione, ID_Classe),
CHECK(ID_Personaggio >= 0 AND ID_Classe >= 0),
FOREIGN KEY(ID_Personaggio, DataCreazione)
	REFERENCES ISTANZA_PERSONAGGIO(ID_Personaggio, DataCreazione)
	ON UPDATE CASCADE ON DELETE SET NULL,
FOREIGN KEY(ID_Classe) REFERENCES CLASSE(ID_Classe)
	ON UPDATE CASCADE ON DELETE SET NULL
);

CREATE TABLE  Promuove(
ID_Classe INTEGER NOT NULL,
PromossoDa INTEGER,
PromuoveIn INTEGER,
PRIMARY KEY(ID_Classe),
FOREIGN KEY(ID_Classe) REFERENCES CLASSE(ID_Classe)
	ON UPDATE CASCADE ON DELETE RESTRICT
);



CREATE TABLE TECNICA(
ID_Tecnica INTEGER NOT NULL,
Nome VARCHAR(30) NOT NULL,
Descrizione VARCHAR,
Costo INTEGER,
Danno INTEGER,
PRIMARY KEY(ID_Tecnica),
CHECK(ID_Tecnica >= 0)
);

CREATE TABLE Impara(
ID_Classe INTEGER NOT NULL,
ID_Tecnica INTEGER NOT NULL,
LivelloRichiesto INTEGER,
PRIMARY KEY(ID_Classe, ID_Tecnica),
CHECK(ID_Classe >= 0 AND ID_Tecnica >= 0),
FOREIGN KEY(ID_Classe) REFERENCES CLASSE(ID_Classe)
	ON UPDATE CASCADE ON DELETE SET NULL,
FOREIGN KEY(ID_Tecnica) REFERENCES TECNICA(ID_Tecnica)
	ON UPDATE CASCADE ON DELETE SET NULL
);

CREATE TABLE OGGETTO(
ID_Oggetto INTEGER NOT NULL,
Nome VARCHAR(20) NOT NULL,
Sprite VARCHAR NOT NULL,
Descrizione VARCHAR(50),
TipoOggetto VARCHAR(20) NOT NULL,
TipoEquip VARCHAR(20),
HP INTEGER,
MP INTEGER,
ATK INTEGER,
DEF INTEGER,
AGI INTEGER,
INT INTEGER,
PRIMARY KEY(ID_Oggetto),
CHECK(ID_Oggetto >= 0)
);

CREATE TABLE Equipaggiabile(
ID_Classe INTEGER NOT NULL,
ID_Oggetto INTEGER NOT NULL,
PRIMARY KEY(ID_Classe, ID_Oggetto),
CHECK(ID_Classe >= 0 AND ID_Oggetto >= 0),
FOREIGN KEY(ID_Classe) REFERENCES CLASSE(ID_Classe)
	ON UPDATE CASCADE ON DELETE SET NULL,
FOREIGN KEY(ID_Oggetto) REFERENCES Oggetto(ID_Oggetto)
	ON UPDATE CASCADE ON DELETE SET NULL
);

CREATE TABLE Equipaggia(
ID_Personaggio INTEGER NOT NULL,
DataCreazione TIMESTAMP NOT NULL,
ID_Oggetto INTEGER NOT NULL,
PRIMARY KEY(ID_Personaggio, DataCreazione, ID_Oggetto),
CHECK(ID_Personaggio >= 0 AND ID_Oggetto >= 0),
FOREIGN KEY(ID_Personaggio, DataCreazione)
	REFERENCES ISTANZA_PERSONAGGIO(ID_Personaggio, DataCreazione)
		ON UPDATE CASCADE ON DELETE SET NULL,
FOREIGN KEY(ID_Oggetto) REFERENCES OGGETTO(ID_Oggetto)
		ON UPDATE CASCADE ON DELETE SET NULL
);

CREATE TABLE Possiede(
DataCreazione TIMESTAMP NOT NULL,
ID_Oggetto INTEGER NOT NULL,
Quantita INTEGER,
PRIMARY KEY(DataCreazione, ID_Oggetto),
CHECK(ID_Oggetto >= 0),
FOREIGN KEY(DataCreazione) REFERENCES SALVATAGGIO_GIOCATORE(DataCreazione)
				ON UPDATE CASCADE ON DELETE SET NULL,
FOREIGN KEY(ID_Oggetto) REFERENCES OGGETTO(ID_Oggetto)
				ON UPDATE CASCADE ON DELETE SET NULL
);

CREATE TABLE Richiede(
ID_Tecnica INTEGER NOT NULL,
ID_Oggetto INTEGER NOT NULL,
Quantita INTEGER,
PRIMARY KEY(ID_Tecnica, ID_Oggetto),
CHECK(ID_Tecnica >= 0 AND ID_Oggetto >= 0),
FOREIGN KEY(ID_Tecnica) REFERENCES TECNICA(ID_Tecnica)
				ON UPDATE CASCADE ON DELETE SET NULL,
FOREIGN KEY(ID_Oggetto) REFERENCES OGGETTO(ID_Oggetto)
				ON UPDATE CASCADE ON DELETE SET NULL
);

CREATE TABLE STATO(
Sigla CHAR(3) NOT NULL,
Nome VARCHAR(20) NOT NULL,
Descrizione VARCHAR,
PRIMARY KEY(Sigla)
);

CREATE TABLE Modifica_T(
ID_Tecnica INTEGER NOT NULL,
Sigla CHAR(3) NOT NULL,
PercentualeSuccesso NUMERIC(5,2),
PRIMARY KEY(ID_Tecnica, Sigla),
FOREIGN KEY(ID_Tecnica) REFERENCES TECNICA(ID_Tecnica)
				ON UPDATE CASCADE ON DELETE SET NULL,

FOREIGN KEY(Sigla) REFERENCES STATO(Sigla)
				ON UPDATE CASCADE ON DELETE SET NULL
);

CREATE TABLE NEMICO(
Nome VARCHAR(30) NOT NULL,
Famiglia VARCHAR(30),
Descrizione VARCHAR,
Sprite VARCHAR NOT NULL,
N_HP INTEGER NOT NULL,
N_MP INTEGER NOT NULL,
N_ATK INTEGER NOT NULL,
N_DEF INTEGER NOT NULL,
N_INT INTEGER NOT NULL,
N_AGI INTEGER NOT NULL,
PRIMARY KEY(Nome),
CHECK( N_HP >= 0
AND N_MP >= 0
AND N_ATK >= 0
AND N_DEF >= 0
AND N_INT >= 0
AND N_AGI >= 0)
);

CREATE TABLE Utilizza(
Nome VARCHAR(30) NOT NULL,
ID_Tecnica INTEGER NOT NULL,
PRIMARY KEY(Nome, ID_Tecnica),
CHECK(ID_Tecnica >= 0),
FOREIGN KEY(Nome) REFERENCES NEMICO(Nome)
				ON UPDATE CASCADE ON DELETE SET NULL,
FOREIGN KEY(ID_Tecnica) REFERENCES TECNICA(ID_Tecnica)
				ON UPDATE CASCADE ON DELETE SET NULL
);

CREATE TABLE Modifica_O(
ID_Oggetto INTEGER NOT NULL,
Sigla CHAR(3) NOT NULL,
PercentualeSuccesso NUMERIC(5,2),
PRIMARY KEY(ID_Oggetto, Sigla),
CHECK(ID_Oggetto >= 0),
FOREIGN KEY(ID_Oggetto) REFERENCES OGGETTO(ID_Oggetto)
				ON UPDATE CASCADE ON DELETE SET NULL,
FOREIGN KEY(Sigla) REFERENCES STATO(Sigla)
				ON UPDATE CASCADE ON DELETE SET NULL
);






CREATE TABLE Cede(
Nome VARCHAR(30) NOT NULL,
ID_Oggetto INTEGER NOT NULL,
Quantita INTEGER,
PRIMARY KEY(Nome, ID_Oggetto),
CHECK(ID_Oggetto >= 0),
FOREIGN KEY(Nome) REFERENCES Nemico(Nome)
				ON UPDATE CASCADE ON DELETE SET NULL,
FOREIGN KEY(ID_Oggetto) REFERENCES OGGETTO(ID_Oggetto)
				ON UPDATE CASCADE ON DELETE SET NULL
);
